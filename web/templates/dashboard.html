{% extends "base.html" %}

{% block content %}
<div class="kpi-row">
    <div class="kpi-card">
        <div class="kpi-icon">
            <svg width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="16" cy="16" r="16" fill="#1A1A2E"/>
                <path d="M16 4C9.37 4 4 9.37 4 16s5.37 12 12 12 12-5.37 12-12S22.63 4 16 4zm5.65 7.05l-3.2 10.5c-.15.5-.55.75-1.05.75-.2 0-.4-.05-.6-.15l-3.1-1.85-1.65 1.6c-.2.2-.45.3-.75.3-.45 0-.8-.35-.8-.8v-2.05l6.8-7.55c.15-.15.1-.35-.1-.25L10.5 17.6l-2.7-1.6c-.5-.3-.55-.75-.05-1.1l13.2-5.15c.5-.2 1 .1.85.65l-.15.65z" fill="#6C6CE5"/>
            </svg>
        </div>
        <div class="kpi-info">
            <div class="kpi-label">Mercury Balance</div>
            <div class="kpi-value" id="kpi-mercury">—</div>
        </div>
    </div>
    <div class="kpi-card">
        <div class="kpi-icon">
            <svg width="28" height="28" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="32" height="32" rx="6" fill="#635BFF"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.08 11.64c0-1.08.89-1.5 2.36-1.5 2.11 0 4.78.64 6.89 1.78V6.3C22.22 5.5 20.13 5 18.02 5c-4.76 0-7.93 2.49-7.93 6.64 0 6.48 8.93 5.45 8.93 8.24 0 1.28-1.12 1.69-2.68 1.69-2.32 0-5.28-.95-7.63-2.24v5.72C11 26.08 13.35 27 15.75 27c4.88 0 8.24-2.41 8.24-6.63 0-6.99-8.91-5.76-8.91-8.73z" fill="#fff"/>
            </svg>
        </div>
        <div class="kpi-info">
            <div class="kpi-label">Stripe Balance</div>
            <div class="kpi-value" id="kpi-stripe">—</div>
        </div>
    </div>
</div>

<div class="chart-container">
    <div id="in-vs-out-chart" class="chart"></div>
</div>
<div class="chart-container">
    <div id="profit-margin-chart" class="chart-medium"></div>
</div>
<div class="chart-container">
    <div id="spend-by-category-chart" class="chart"></div>
</div>

<div class="chart-row">
    <div class="chart-container chart-half">
        <div id="revenue-by-client-chart" class="chart-fixed"></div>
    </div>
    <div class="chart-container chart-half">
        <div id="concentration-risk-chart" class="chart-fixed"></div>
    </div>
</div>

<div class="chart-container" style="position:relative;">
    <button id="remind-all-btn" class="btn-remind-all" onclick="remindAllOverdue()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
            <polyline points="22,6 12,13 2,6"/>
        </svg>
        <span>Remind All Overdue</span>
    </button>
    <div id="expected-revenue-chart" class="chart-fixed-tall"></div>
</div>

<div class="chart-container">
    <div id="days-to-pay-chart" class="chart-fixed"></div>
</div>

<!-- Spend detail drill-down modal -->
<div id="spend-detail-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <button class="modal-close" id="modal-close-btn">&times;</button>
        <div id="spend-detail-chart" style="width:100%;height:100%;"></div>
    </div>
</div>

<!-- Invoice detail drill-down modal -->
<div id="invoice-detail-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content modal-content-wide">
        <button class="modal-close" id="invoice-modal-close-btn">&times;</button>
        <h2 id="invoice-modal-title" class="modal-title">Open Invoices</h2>
        <div id="invoice-table-container" class="invoice-table-container">
            <table class="invoice-table">
                <thead>
                    <tr>
                        <th>Invoice #</th>
                        <th>Amount Due</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="invoice-table-body"></tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('web.static', filename='js/dashboard.js') }}"></script>
{% endblock %}
